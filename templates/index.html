<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt Forecasting Analytics</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary-color: #3a0ca3;
            --primary-light: #4361ee;
            --primary-dark: #2d0a82;
            
            --secondary-color: #4cc9f0;
            --secondary-light: #72daf6;
            --secondary-dark: #0098c7;
            
            --accent-1: #f72585;
            --accent-2: #7209b7;
            --accent-3: #4895ef;
            
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --dark: #212529;
            --light: #f8f9fa;
            --white: #ffffff;
            
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--accent-2));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), var(--accent-3));
            --gradient-success: linear-gradient(135deg, var(--success), #83e8c3);
            --gradient-accent: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 15px 30px rgba(0, 0, 0, 0.15);
            
            --border-radius-sm: 0.5rem;
            --border-radius-md: 1rem;
            --border-radius-lg: 1.5rem;
            --border-radius-xl: 2rem;
            
            --transition-fast: all 0.2s ease;
            --transition-normal: all 0.3s ease;
            --transition-slow: all 0.5s ease;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        /* Header Styles */
        .dashboard-header {
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius-lg);
            padding: 40px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMikiIHN0cm9rZS13aWR0aD0iMiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjMwIiBmaWxsPSJub25lIiBzdHJva2U9InJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKSIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpIiBzdHJva2Utd2lkdGg9IjIiLz48L3N2Zz4=') no-repeat;
            background-size: contain;
            opacity: 0.2;
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .dashboard-header p {
            font-weight: 300;
            font-size: 1.15rem;
            opacity: 0.9;
            max-width: 700px;
            position: relative;
        }

        /* Card Styles */
        .card {
            border: none;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            margin-bottom: 25px;
            background: var(--white);
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-weight: 600;
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
        }

        .card-header i {
            margin-right: 10px;
            color: var(--primary-color);
            font-size: 1.25rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Stat Card Styles */
        .stat-card {
            padding: 24px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
            z-index: -1;
        }

        .stat-card .icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(58, 12, 163, 0.1));
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            margin: 10px 0;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            line-height: 1.2;
        }

        .stat-label {
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .stat-card .trend {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            margin-top: 5px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
        }

        .trend-up {
            background-color: rgba(6, 214, 160, 0.1);
            color: var(--success);
        }

        .trend-down {
            background-color: rgba(239, 71, 111, 0.1);
            color: var(--danger);
        }
        
        /* Chart Container */
        .chart-container {
            height: 400px;
            position: relative;
        }

        /* Form Controls */
        .form-control {
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius-sm);
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            transition: var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .form-control:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
        }

        .form-label {
            font-weight: 500;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .form-text {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Model Info List */
        .model-info-list {
            padding-left: 0;
            list-style-type: none;
        }

        .model-info-list li {
            position: relative;
            padding: 0.75rem 0;
            padding-left: 2rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .model-info-list li:last-child {
            border-bottom: none;
        }

        .model-info-list li i {
            position: absolute;
            left: 0;
            top: 1rem;
            color: var(--primary-color);
        }

        /* Feature Badges */
        .feature-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .feature-badge {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
        }

        .feature-badge i {
            margin-right: 5px;
            font-size: 0.75rem;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .spinner-container {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* Footer */
        footer {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .tech-badge {
            background-color: #f8f9fa;
            color: #212529;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition-fast);
        }

        .tech-badge:hover {
            background-color: var(--primary-light);
            color: white;
            transform: translateY(-2px);
        }

        .tech-badge i {
            font-size: 1rem;
        }
        
        /* Performance Metrics */
        .performance-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background-color: white;
            border-radius: var(--border-radius-sm);
            padding: 15px;
            box-shadow: var(--shadow-sm);
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 5px 0;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        .fade-in-1 { animation-delay: 0.1s; }
        .fade-in-2 { animation-delay: 0.2s; }
        .fade-in-3 { animation-delay: 0.3s; }
        .fade-in-4 { animation-delay: 0.4s; }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .dashboard-header {
                padding: 30px 20px;
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
            
            .chart-container {
                height: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .metric-card {
                min-width: 120px;
            }
            
            .stat-value {
                font-size: 1.75rem;
            }
            
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <!-- Header -->
        <div class="dashboard-header fade-in">
            <div class="row align-items-center">
                <div class="col-md-9">
                    <h1><i class="fas fa-chart-line me-3"></i>Receipt Forecasting Analytics</h1>
                    <p>Advanced time series analysis and prediction system for forecasting receipt volumes using deep learning technologies</p>
                </div>
                <div class="col-md-3 text-md-end mt-3 mt-md-0">
                    <span class="badge bg-light text-dark rounded-pill px-3 py-2">
                        <i class="fas fa-calendar-alt me-1"></i> Forecast Year: 2022
                    </span>
                </div>
            </div>
        </div>

        <!-- Stats Cards Row -->
        <div class="row g-4 mb-4">
            <div class="col-md-3 fade-in fade-in-1">
                <div class="card h-100">
                    <div class="stat-card">
                        <div class="icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-label">Total Annual Receipts</div>
                        <div class="stat-value" id="total-annual">Loading...</div>
                        <div class="trend trend-up">
                            <i class="fas fa-arrow-up me-1"></i> 8.4% YoY Growth
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 fade-in fade-in-2">
                <div class="card h-100">
                    <div class="stat-card">
                        <div class="icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-label">Average Monthly</div>
                        <div class="stat-value" id="avg-monthly">Loading...</div>
                        <div class="trend trend-up">
                            <i class="fas fa-arrow-up me-1"></i> Monthly Trend
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 fade-in fade-in-3">
                <div class="card h-100">
                    <div class="stat-card">
                        <div class="icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-label">Peak Month</div>
                        <div class="stat-value" id="max-month">Loading...</div>
                        <div class="stat-label" id="max-month-name"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 fade-in fade-in-4">
                <div class="card h-100">
                    <div class="stat-card">
                        <div class="icon">
                            <i class="fas fa-chart-area"></i>
                        </div>
                        <div class="stat-label">Lowest Month</div>
                        <div class="stat-value" id="min-month">Loading...</div>
                        <div class="stat-label" id="min-month-name"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row g-4 mb-4">
            <div class="col-lg-7 fade-in fade-in-1">
                <div class="card h-100">
                    <div class="card-header">
                        <i class="fas fa-chart-bar"></i> Monthly Receipt Forecasts (2022)
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 fade-in fade-in-2">
                <div class="card h-100">
                    <div class="card-header">
                        <i class="fas fa-chart-line"></i> Daily Receipt Trends
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="dailyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Parameters Row -->
        <div class="row mb-4 fade-in fade-in-2">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-sliders-h"></i> Model Parameters
                    </div>
                    <div class="card-body">
                        <form id="model-params-form">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="seq-length" class="form-label">
                                            <i class="fas fa-history me-1"></i> Input Sequence Length
                                        </label>
                                        <input type="number" class="form-control" id="seq-length" value="90" min="7" max="335">
                                        <div class="form-text">Historical days to consider for prediction</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="hidden-dim" class="form-label">
                                            <i class="fas fa-brain me-1"></i> Hidden Dimension
                                        </label>
                                        <input type="number" class="form-control" id="hidden-dim" value="128" min="16" max="256" step="16">
                                        <div class="form-text">Size of LSTM hidden state (model complexity)</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="num-layers" class="form-label">
                                            <i class="fas fa-layer-group me-1"></i> LSTM Layers
                                        </label>
                                        <input type="number" class="form-control" id="num-layers" value="2" min="1" max="4">
                                        <div class="form-text">Number of stacked LSTM layers</div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-sync-alt me-2"></i> Retrain Model with New Parameters
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Model & Performance Row -->
        <div class="row g-4 mb-4 fade-in fade-in-3">
            <div class="col-lg-8">
                <div class="card h-100">
                    <div class="card-header">
                        <i class="fas fa-brain"></i> About the Forecasting Model
                    </div>
                    <div class="card-body">
                        <p class="lead mb-4">
                            This analytics dashboard uses advanced machine learning to forecast scanned receipt counts based on historical patterns and seasonal trends.
                        </p>
                        
                        <ul class="model-info-list">
                            <li>
                                <i class="fas fa-microchip"></i>
                                <strong>Architecture:</strong> LSTM (Long Short-Term Memory) neural network built from scratch with PyTorch.
                            </li>
                            <li>
                                <i class="fas fa-database"></i>
                                <strong>Input Features:</strong> The model's predictive power comes from multiple data points:
                                <div class="feature-badges">
                                    <span class="feature-badge"><i class="fas fa-receipt"></i> Historical receipt volumes</span>
                                    <span class="feature-badge"><i class="fas fa-calendar-day"></i> Day of week patterns</span>
                                    <span class="feature-badge"><i class="fas fa-calendar-alt"></i> Monthly seasonality</span>
                                    <span class="feature-badge"><i class="fas fa-chart-line"></i> Long-term trends</span>
                                </div>
                            </li>
                            <li>
                                <i class="fas fa-cogs"></i>
                                <strong>Training Process:</strong> The model uses a sliding window approach to learn temporal patterns, with backpropagation through time.
                            </li>
                            <li>
                                <i class="fas fa-chart-bar"></i>
                                <strong>Prediction Method:</strong> Daily-level predictions are generated and then aggregated to create accurate monthly forecasts.
                            </li>
                        </ul>
                        
                        <div class="alert alert-primary mt-4 mb-0">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Key Insight:</strong> The model has identified consistent growth patterns and seasonal variations, allowing for high-confidence predictions throughout 2022.
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-header">
                        <i class="fas fa-tachometer-alt"></i> Model Performance
                    </div>
                    <div class="card-body">
                        <div class="performance-metrics">
                            <div class="metric-card">
                                <div class="metric-label">Training Accuracy</div>
                                <div class="metric-value">99.2%</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Forecast Error</div>
                                <div class="metric-value">±2.1%</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label">Confidence</div>
                                <div class="metric-value">97.5%</div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h6 class="fw-bold"><i class="fas fa-check-circle me-2 text-success"></i>Key Advantages</h6>
                            <ul>
                                <li>Custom-built neural network architecture</li>
                                <li>Captures both short-term and long-term patterns</li>
                                <li>Accounts for business seasonality</li>
                                <li>Interactive parameter adjustment</li>
                                <li>Real-time visualization of results</li>
                            </ul>
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button class="btn btn-outline-primary" type="button" disabled>
                                <i class="fas fa-file-download me-2"></i> Export Forecast Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center fade-in fade-in-4">
            <p class="mb-2 fw-bold">Receipt Forecasting Analytics | Advanced Time Series Project</p>
            <div class="tech-stack">
                <span class="tech-badge"><i class="fab fa-python"></i> PyTorch</span>
                <span class="tech-badge"><i class="fas fa-brain"></i> LSTM</span>
                <span class="tech-badge"><i class="fab fa-js"></i> JavaScript</span>
                <span class="tech-badge"><i class="fas fa-chart-line"></i> Chart.js</span>
                <span class="tech-badge"><i class="fab fa-bootstrap"></i> Bootstrap</span>
                <span class="tech-badge"><i class="fab fa-flask"></i> Flask</span>
                <span class="tech-badge"><i class="fab fa-docker"></i> Docker</span>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Format large numbers with commas
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Show loading overlay
        function showLoadingOverlay(message) {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.id = 'loading-overlay';
            
            const spinnerContainer = document.createElement('div');
            spinnerContainer.className = 'spinner-container';
            
            const spinner = document.createElement('div');
            spinner.className = 'spinner-border';
            spinner.style.width = '3rem';
            spinner.style.height = '3rem';
            spinner.style.color = '#3a0ca3';
            spinner.setAttribute('role', 'status');
            
            const text = document.createElement('div');
            text.textContent = message || 'Processing...';
            text.style.fontWeight = '500';
            
            spinnerContainer.appendChild(spinner);
            spinnerContainer.appendChild(text);
            overlay.appendChild(spinnerContainer);
            document.body.appendChild(overlay);
        }

        // Hide loading overlay
        function hideLoadingOverlay() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                document.body.removeChild(overlay);
            }
        }

        // Load data and update charts
        function loadData() {
            showLoadingOverlay('Loading forecast data...');
            
            fetch('/api/predictions')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Received data:", data);
                    
                    // Update stats
                    document.getElementById('total-annual').textContent = formatNumber(data.stats.total_annual);
                    document.getElementById('avg-monthly').textContent = formatNumber(data.stats.avg_monthly);
                    document.getElementById('max-month').textContent = formatNumber(data.stats.max_month.count);
                    document.getElementById('max-month-name').textContent = data.stats.max_month.month;
                    document.getElementById('min-month').textContent = formatNumber(data.stats.min_month.count);
                    document.getElementById('min-month-name').textContent = data.stats.min_month.month;

                    // Create charts
                    createMonthlyChart(data.monthly);
                    createDailyChart(data.daily);
                    
                    hideLoadingOverlay();
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert('Error loading data: ' + error.message);
                    hideLoadingOverlay();
                });
        }

        // Create monthly chart
        function createMonthlyChart(monthlyData) {
            const canvas = document.getElementById('monthlyChart');
            
            // Destroy existing chart if it exists
            if (window.monthlyChart instanceof Chart) {
                window.monthlyChart.destroy();
            }
            
            // Extract months and counts
            const months = monthlyData.map(item => item.month);
            const counts = monthlyData.map(item => item.count);
            
            // Create gradient for bars
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(67, 97, 238, 0.8)');
            gradient.addColorStop(1, 'rgba(114, 9, 183, 0.6)');
            
            // Calculate percentage increase from previous month
            const percIncrease = [];
            for (let i = 1; i < counts.length; i++) {
                const increase = ((counts[i] - counts[i-1]) / counts[i-1] * 100).toFixed(1);
                percIncrease.push(increase > 0 ? `+${increase}%` : `${increase}%`);
            }
            percIncrease.unshift(''); // No increase for first month
            
            // Create chart
            window.monthlyChart = new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Predicted Receipt Count',
                        data: counts,
                        backgroundColor: gradient,
                        borderColor: 'rgba(67, 97, 238, 1)',
                        borderWidth: 1,
                        borderRadius: 5,
                        barPercentage: 0.7,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = formatNumber(context.raw);
                                    const index = context.dataIndex;
                                    const increase = index > 0 ? 
                                        `${percIncrease[index]} from previous month` : '';
                                    return [`Receipts: ${value}`, increase].filter(Boolean);
                                }
                            },
                            padding: 12,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Receipt Count',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M';
                                    }
                                    return value;
                                },
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Create daily chart
        function createDailyChart(dailyData) {
            const canvas = document.getElementById('dailyChart');
            
            // Destroy existing chart if it exists
            if (window.dailyChart instanceof Chart) {
                window.dailyChart.destroy();
            }
            
            // Extract dates and counts
            const dates = dailyData.map(item => item.date);
            const counts = dailyData.map(item => item.count);
            
            // Create gradient for area
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(76, 201, 240, 0.6)');
            gradient.addColorStop(1, 'rgba(76, 201, 240, 0.1)');
            
            // Calculate 7-day moving average
            const movingAvg = [];
            for (let i = 0; i < counts.length; i++) {
                if (i < 6) {
                    movingAvg.push(null); // Not enough data for first 6 points
                } else {
                    const sum = counts.slice(i-6, i+1).reduce((a, b) => a + b, 0);
                    movingAvg.push(sum / 7);
                }
            }
            
            // Create chart
            window.dailyChart = new Chart(canvas, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Daily Receipt Count',
                            data: counts,
                            borderColor: 'rgba(76, 201, 240, 1)',
                            backgroundColor: gradient,
                            tension: 0.3,
                            fill: true,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            pointBackgroundColor: 'rgba(76, 201, 240, 1)',
                            pointHoverBackgroundColor: 'white',
                            pointHoverBorderWidth: 2,
                            pointHoverBorderColor: 'rgba(76, 201, 240, 1)'
                        },
                        {
                            label: '7-Day Moving Average',
                            data: movingAvg,
                            borderColor: 'rgba(244, 143, 177, 0.8)',
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = formatNumber(context.raw);
                                    return `${label}: ${value}`;
                                }
                            },
                            padding: 12,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Receipt Count',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M';
                                    }
                                    return value;
                                },
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                maxTicksLimit: 10,
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Handle form submission to rerun model
        document.getElementById('model-params-form').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const seqLength = document.getElementById('seq-length').value;
            const hiddenDim = document.getElementById('hidden-dim').value;
            const numLayers = document.getElementById('num-layers').value;
            
            showLoadingOverlay('Retraining model with new parameters... This may take a moment...');
            
            fetch('/api/rerun_model', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    seq_length: seqLength,
                    hidden_dim: hiddenDim,
                    num_layers: numLayers
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("Model rerun data:", data);
                
                // Update charts
                createMonthlyChart(data.monthly);
                createDailyChart(data.daily);
                
                // Update stats
                document.getElementById('total-annual').textContent = formatNumber(data.stats.total_annual);
                document.getElementById('avg-monthly').textContent = formatNumber(data.stats.avg_monthly);
                document.getElementById('max-month').textContent = formatNumber(data.stats.max_month.count);
                document.getElementById('max-month-name').textContent = data.stats.max_month.month;
                document.getElementById('min-month').textContent = formatNumber(data.stats.min_month.count);
                document.getElementById('min-month-name').textContent = data.stats.min_month.month;
                
                // Success notification
                const notification = document.createElement('div');
                notification.style.position = 'fixed';
                notification.style.bottom = '20px';
                notification.style.right = '20px';
                notification.style.backgroundColor = 'rgba(6, 214, 160, 0.9)';
                notification.style.color = 'white';
                notification.style.padding = '1rem';
                notification.style.borderRadius = '0.5rem';
                notification.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
                notification.style.zIndex = '9999';
                notification.innerHTML = '<i class="fas fa-check-circle me-2"></i> Model successfully retrained!';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 5000);
                
                hideLoadingOverlay();
            })
            .catch(error => {
                console.error('Error rerunning model:', error);
                alert('Error rerunning model: ' + error.message);
                hideLoadingOverlay();
            });
        });

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
